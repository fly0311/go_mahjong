# go mahjong
## UI

```
                             client                           api                            service | model
#login                         |                               |                                     |
  |                            |                               |                                     |
  |@login--------------------->|------------------------------>|----+                                |
  |                            |                               |    | login------>cell service       |
  | #game-center               |                 token         |    |    |            |              |
  |   |                        |<----saveToken<----------------|<---+    |<-----------+              |
  |   |                        |                               |                                     |   gameInfo
  |   |                        |@getUserInfo------------------>|----+                      select    |     |  setInfo
  |   |                        |                               |    | check user and game----------->|-----+--+  |
  |   |                        |             reload<-----------|<---+    |                           |--------|--+--+
  |   |                        |  invalid token |              |         |<--------------------------|<----+--+     |
  |<--|------------------------|<---------------+              |         |                           |     |        |
  |   |                        |  game list     |              |         |<--------------------------|<----|-----+--+
  |   |<-----------------------|<---------------+              |                                     |     |     |
  |   |                        |                |              |                                     |     |     |
  |   |@checkToken------------>|----+           |              |                                     |     |     |
  |   |                        |    | no token  |              |                                     |     |     |
  |<--|------------------------|<---+           |              |                                     |     |     |
      |                        |                |              |                                     |     |     |
      |@toCreateGame---------->|----+           |              |                                     |     |     |
      |                        |    |           |              |                                     |     |     |
      |    #create-game        |    |           |              |                                     |     |     |
      |          |<------------|<---+           |              |                                     |     |     |
      |          |             |                |              |                                     |     |     |
      |          |@createGame->|----------------|------------->|----+                   create       |     |     |
      |                        |                |              |    | create game------------------->|-----+--+  |
      |        #game-view      |                |              |    |    |                           |        |  |
      |            |           |  game info     |              |    |    |<--------------------------|<----+--+  |
      |            |<----------|<---------------+              |    |                                |     |     |
      |            |<----------|<---------------|--------------|<---+                                |     |     |
      |            |           |                |              |                                     |     |     |
      |@toJoinGame-|---------->|----------------|------------->|----+                   update       |     |     |
      |            |           |                |              |    | join game--------------------->|-----+--+  |
      |            |<----------|<---------------|--------------|<---+    |                           |        |  |
      |            |           |                |              |         |<--------------------------|<----+--+  |
      |            |@ready---->|----------------|------------->|----+              create or update  |           |
      |                        |                |              |    | ready game-------------------->|-----------+--+
      |        #set-view       |                |              |    |    |                           |              |
      |          |             |  set info      |              |    |    |<--------------------------|<----------+--+
      |          |<------------|<---------------+              |    |                                |           |
      |          |<------------|<------------------------------|<---+                                |           |
      |          |             |                               |                                     |           |
      |          |@op--------->|------------------------------>|----+              update            |           |
      |          |             |                               |    | op---------------------------->|-----------+--+
      |          |             |<------------------------------|<---+  |                             |              |
      |          |             |                               |       |<----------------------------|<----------+--+
      |          |@sync------->|------------------------------>|----+                  select        |           |
      |          |             |                               |    | sync set info----------------->|-----------+--+
      |          |             |             refresh           |    |        |                       |              |
      |          |             |                |<-------------|<---+        |<----------------------|<----------+--+
      |          |<------------|<---------------+              |                                     |           |
      |          |             |                |              |                                     |           |
      |          | #win-view   |  win info      |              |                                     |           |
      |          |   |<--------|<---------------+              |                                     |           |
      |          |   |         |                |              |                                     |           |
      |          |   |@next--->|----------------|------------->|----+        create or update        |           |
      |          |             |                |              |    | next-------------------------->|-----------+--+
      |          |<------------|<---------------|--------------|<---+  |                             |              |
      |                        |                |              |       |<----------------------------|<----------+--+
      |            #finish-view|  finish info   |              |                                     |           |
      |              |<--------|<---------------+              |                                     |           |
      |              |         |                               |                                     |           |
      |              |@finsh-->|----+                          |                                     |           |
      |                        |    |                          |                                     |           |
      |<-----------------------|<---+                          |                                     |           |
```
## API
```
login
    >username
    >password
    <token
check-user-game-info
    >token
    <gameList
    <gameInfo
    <setInfo
create-game
    >token
    >option
    <gameInfo
join-game
    >token
    >gameId
    <gameInfo
reday-game
    >token
    <setInfo
op
    >token
    >opOption
next
    >token
    <setInfo
```
## FSM
```
create
--------->| join x+1
          |----------->|
          | ready y+1  |
          |----------->|
          |            | x == maxPlayer|<----------------------+
          |<-----------| y == maxPlayer|                       |
          |            |-------------->| do a set z+1          |
          |            |               |--------------+....+-->| z == maxSet
          |            |               |              |    |   |-------------->|
          game         game            game           |    | game             game
           |player x    |player x+1     |player max   |    |   |player max      |player max
           |set z       |set z          |set z        |    |   |set z+1         |set max
           |prepare y   |prepare y+1    |prepare max  |    |   |prepare max     |prepare max
           |waiting     |waiting        |waiting      |    |   |gaming          |finish
|<----------------------------------------------------+    |
| create                                                   +-------------------------------+
|--------->|<---------------------------------------------------------------------------+  |
           |  y do x or pass                                                            |  |
           |------------------>| nextEvent x+1                                          |  |
           |                   |------------------>| x over eventStack                  |  |
           |                   |                   |------------------>| nextPlayer y+1 |  |
           |                   |                   |--------------+    |--------------->|  |
           set                set                 set             |   set                  |
             |curPlayer y       |curPlayer y        |curPlayer y  |     |curPlayer y+1     |
             |curEvent x        |curEvent x+1       |curEvent x   |     |curEvent x        |
                                                                  |                        |
                                                                  +--->|                   |
                                                                       |-------------------+
                                                                       set
                                                                         |winInfo


```
